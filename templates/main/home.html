{% extends 'base.html' %}
{% load static %}

{% block title %}Компания Аргус - Противопожарные системы{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative h-[500px] md:h-[600px] flex items-center justify-center overflow-hidden">
    <div class="absolute inset-0">
        <img src="{% static 'images/ЖК Домашний ГП-11.jpeg' %}" alt="Компания Аргус" class="w-full h-full object-cover transition-transform duration-800 hover:scale-105">
        <div class="absolute inset-0 bg-dark-blue/80 transition-all duration-500"></div>
    </div>
    <div class="relative z-10 container mx-auto px-4 sm:px-6 text-center text-white">
        <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl mb-4 sm:mb-6 font-bold animate-slide-up">Надежность и опыт с 2004 года</h1>
        <p class="text-base sm:text-lg md:text-xl mb-6 sm:mb-8 max-w-2xl mx-auto text-white/90 leading-relaxed animate-slide-up" data-animation-delay="0.1s">
            Компания Аргус — эксперт в области строительства и пожарной безопасности. 
            Более 20 лет успешной работы с государственными и коммерческими заказчиками.
        </p>
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center animate-slide-up" data-animation-delay="0.2s">
            <a href="{% url 'order_kp' %}" class="btn-gold text-white px-5 py-3 sm:px-6 sm:py-4 md:px-8 md:py-4 rounded-xl font-medium shadow-lg transition-all duration-400 hover:bg-amber-700 text-sm sm:text-base md:text-lg whitespace-nowrap">
                Оставить заявку
            </a>
            <a href="{% url 'projects' %}" class="border-2 border-white text-white hover:bg-white hover:text-dark-blue px-5 py-3 sm:px-6 sm:py-4 md:px-8 md:py-4 rounded-xl transition-all duration-400 font-medium text-sm sm:text-base md:text-lg whitespace-nowrap">
                Наши проекты
            </a>
        </div>
    </div>
</section>

<!-- Блок новостей -->
{% if promo_blocks %}
<section class="py-12 sm:py-16 promo-section">
    <div class="container mx-auto px-4 sm:px-6">
        <div class="text-center mb-8 sm:mb-12">
            <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-dark-blue mb-3 sm:mb-4">Новости компании</h2>
            <p class="text-base sm:text-lg text-gray-600 max-w-2xl mx-auto">Актуальные события и важные обновления</p>
        </div>

        <!-- Разные варианты отображения в зависимости от количества промо-блоков -->
        {% with total_promo=promo_blocks|length %}
            {% if total_promo == 1 %}
                <!-- Один промо-блок - отображаем как отдельную карточку -->
                <div class="max-w-2xl mx-auto">
                    {% with promo=promo_blocks.0 %}
                    <div class="news-card rounded-xl shadow-lg overflow-hidden transform transition-all duration-400 hover:shadow-xl cursor-pointer" 
                         data-news-index="0"
                         data-bg-color="{{ promo.background_color|default:'#1E3A8A' }}"
                         data-text-color="{{ promo.text_color|default:'#FFFFFF' }}"
                         data-button-color="{{ promo.button_color|default:'#C9A96A' }}"
                         data-button-text="{{ promo.button_text|default:'' }}"
                         data-button-url="{{ promo.button_url|default:'' }}"
                         data-promo-text="{{ promo.text|default:'' }}"
                         data-promo-date="{{ promo.created_at|date:'d.m.Y'|default:'Сегодня' }}">
                        
                        {% if promo.image %}
                        <div class="news-media relative h-40 sm:h-48 overflow-hidden group">
                            <img src="{{ promo.image.url }}" alt="{{ promo.title|default:'Новость' }}" 
                                 class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-105">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent group-hover:from-black/20 transition-all duration-400"></div>
                        </div>
                        <div class="news-content p-4 sm:p-6">
                            {% if promo.title %}
                            <h3 class="text-lg sm:text-xl font-bold mb-2 sm:mb-3 leading-tight" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                {{ promo.title }}
                            </h3>
                            {% endif %}
                            
                            {% if promo.text %}
                            <div class="mb-3 sm:mb-4 leading-relaxed line-clamp-3" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                {{ promo.text|striptags|truncatewords:30 }}
                            </div>
                            {% endif %}
                            
                            <div class="flex items-center justify-between pt-3 sm:pt-4 border-t" data-border-color="{{ promo.text_color|default:'#FFFFFF' }}30">
                                <span class="text-xs sm:text-sm font-medium" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                    {{ promo.created_at|date:"d.m.Y"|default:"Сегодня" }}
                                </span>
                                <span class="text-xs font-medium" data-button-color="{{ promo.button_color|default:'#C9A96A' }}">
                                    {% if promo.button_text %}{{ promo.button_text }}{% else %}Читать далее{% endif %}
                                </span>
                            </div>
                        </div>
                        {% else %}
                        <!-- Если нет фото - весь контент по центру -->
                        <div class="h-full flex flex-col min-h-[200px] sm:min-h-[250px]">
                            <div class="flex-1 flex flex-col justify-center items-center text-center p-4 sm:p-6">
                                {% if promo.title %}
                                <h3 class="text-lg sm:text-xl font-bold mb-3 sm:mb-4 leading-tight" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                    {{ promo.title }}
                                </h3>
                                {% endif %}
                                
                                {% if promo.text %}
                                <div class="text-sm sm:text-base leading-relaxed" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                    {{ promo.text|striptags|truncatewords:50 }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="flex items-center justify-between p-4 sm:p-6 pt-3 border-t" data-border-color="{{ promo.text_color|default:'#FFFFFF' }}30">
                                <span class="text-xs sm:text-sm font-medium" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                    {{ promo.created_at|date:"d.m.Y"|default:"Сегодня" }}
                                </span>
                                <span class="text-xs font-medium" data-button-color="{{ promo.button_color|default:'#C9A96A' }}">
                                    {% if promo.button_text %}{{ promo.button_text }}{% else %}Читать далее{% endif %}
                                </span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endwith %}
                </div>

            {% else %}
                <!-- Два и более промо-блока - отображаем в карусели на мобильных -->
                <div class="relative max-w-6xl mx-auto px-2 sm:px-0">
                    <!-- Карусель контейнер -->
                    <div class="news-carousel-container overflow-hidden rounded-2xl">
                        <div id="newsCarousel" class="flex transition-transform duration-500 ease-in-out">
                            {% for promo in promo_blocks %}
                            <div class="news-slide flex-shrink-0 px-2 sm:px-3 cursor-pointer" data-news-index="{{ forloop.counter0 }}">
                                <div class="news-card h-full rounded-xl shadow-lg overflow-hidden transform transition-all duration-400 hover:shadow-xl hover:scale-[1.02]"
                                     data-bg-color="{{ promo.background_color|default:'#1E3A8A' }}"
                                     data-text-color="{{ promo.text_color|default:'#FFFFFF' }}"
                                     data-button-color="{{ promo.button_color|default:'#C9A96A' }}"
                                     data-button-text="{{ promo.button_text|default:'' }}"
                                     data-button-url="{{ promo.button_url|default:'' }}"
                                     data-promo-text="{{ promo.text|default:'' }}"
                                     data-promo-date="{{ promo.created_at|date:'d.m.Y'|default:'Сегодня' }}">
                                    
                                    <!-- Медиа контент -->
                                    {% if promo.image %}
                                    <div class="news-media relative h-32 sm:h-40 overflow-hidden group">
                                        <img src="{{ promo.image.url }}" alt="{{ promo.title|default:'Новость' }}" 
                                             class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-105">
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent group-hover:from-black/20 transition-all duration-400"></div>
                                    </div>
                                    <!-- Контент новости с фото -->
                                    <div class="news-content p-4 sm:p-5 flex flex-col justify-between h-full">
                                        <div class="flex-1">
                                            {% if promo.title %}
                                            <h3 class="text-base sm:text-lg font-bold mb-2 sm:mb-3 leading-tight line-clamp-2" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                                {{ promo.title }}
                                            </h3>
                                            {% endif %}
                                            
                                            {% if promo.text %}
                                            <div class="text-xs sm:text-sm mb-3 sm:mb-4 leading-relaxed line-clamp-3" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                                {{ promo.text|striptags|truncatewords:20 }}
                                            </div>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="flex items-center justify-between pt-2 sm:pt-3 border-t" data-border-color="{{ promo.text_color|default:'#FFFFFF' }}30">
                                            <span class="text-xs font-medium" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                                {{ promo.created_at|date:"d.m.Y"|default:"Сегодня" }}
                                            </span>
                                            <span class="text-xs font-medium" data-button-color="{{ promo.button_color|default:'#C9A96A' }}">
                                                {% if promo.button_text %}{{ promo.button_text }}{% else %}Читать далее{% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    {% else %}
                                    <!-- Если нет фото - весь контент по центру -->
                                    <div class="h-full flex flex-col min-h-[160px] sm:min-h-[180px]">
                                        <div class="flex-1 flex flex-col justify-center items-center text-center p-4 sm:p-5">
                                            {% if promo.title %}
                                            <h3 class="text-base sm:text-lg font-bold mb-2 sm:mb-3 leading-tight line-clamp-2" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                                {{ promo.title }}
                                            </h3>
                                            {% endif %}
                                            
                                            {% if promo.text %}
                                            <div class="text-xs sm:text-sm leading-relaxed line-clamp-3" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                                {{ promo.text|striptags|truncatewords:20 }}
                                            </div>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="flex items-center justify-between p-4 sm:p-5 pt-2 border-t" data-border-color="{{ promo.text_color|default:'#FFFFFF' }}30">
                                            <span class="text-xs font-medium" data-text-color="{{ promo.text_color|default:'#FFFFFF' }}">
                                                {{ promo.created_at|date:"d.m.Y"|default:"Сегодня" }}
                                            </span>
                                            <span class="text-xs font-medium" data-button-color="{{ promo.button_color|default:'#C9A96A' }}">
                                                {% if promo.button_text %}{{ promo.button_text }}{% else %}Читать далее{% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Навигационные кнопки -->
                    {% if total_promo > 1 %}
                    <button id="prevNews" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-dark-blue p-2 sm:p-3 rounded-full shadow-lg transition-all duration-300 z-10 ml-1 sm:ml-2 hover:scale-110 border border-gray-200">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button id="nextNews" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-white/80 hover:bg-white text-dark-blue p-2 sm:p-3 rounded-full shadow-lg transition-all duration-300 z-10 mr-1 sm:mr-2 hover:scale-110 border border-gray-200">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                    {% endif %}
                </div>

                <!-- Индикаторы для карусели -->
                {% if total_promo > 1 %}
                <div class="flex justify-center mt-6 sm:mt-8 space-x-2">
                    {% for promo in promo_blocks %}
                    <button class="news-indicator w-2 h-2 rounded-full bg-gray-300 transition-all duration-300 {% if forloop.first %}bg-dark-blue active{% endif %}"
                            data-index="{{ forloop.counter0 }}"></button>
                    {% endfor %}
                </div>
                {% endif %}
            {% endif %}
        {% endwith %}
    </div>
</section>

<!-- Модальное окно для новостей -->
<div id="newsModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden p-3 sm:p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[85vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0">
        <div class="relative">
            <button id="closeNewsModal" class="absolute top-3 right-3 sm:top-4 sm:right-4 z-10 bg-white/90 hover:bg-white text-dark-blue p-1.5 sm:p-2 rounded-full shadow-lg transition-all duration-300 hover:scale-110 border border-gray-300">
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <div id="newsModalContent" class="p-4 sm:p-6">
                <!-- Контент будет подгружаться динамически -->
            </div>
        </div>
    </div>
</div>

<style>
.news-section {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

.news-carousel-container {
    border-radius: 1rem;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    padding: 0.5rem 0;
}

.news-slide {
    width: calc(100% / var(--slides-per-view, 1));
    transition: width 0.3s ease;
}

.news-card {
    position: relative;
    overflow: hidden;
    margin: 0 0.125rem;
    min-height: 280px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.news-card:hover {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
}

.news-media {
    position: relative;
}

.news-content {
    position: relative;
    z-index: 2;
}

/* Ограничение текста */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.news-indicator {
    cursor: pointer;
    transition: all 0.3s ease;
}

.news-indicator:hover {
    transform: scale(1.3);
}

.news-indicator.active {
    background-color: #1E3A8A !important;
    transform: scale(1.3);
}

/* Стили для модального окна */
.modal-text-content {
    line-height: 1.7;
    font-size: 1rem;
}

@media (min-width: 640px) {
    .modal-text-content {
        font-size: 1.125rem;
    }
}

.modal-text-content p {
    margin-bottom: 1rem;
}

.modal-text-content strong {
    font-weight: 600;
}

.modal-text-content em {
    font-style: italic;
}

/* Анимации */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.news-section {
    animation: fadeIn 0.6s ease-out;
}

.news-card {
    animation: slideInUp 0.5s ease-out;
}

#newsModal.show .rounded-xl {
    animation: modalAppear 0.3s ease-out forwards;
}

/* Адаптивность */
@media (max-width: 480px) {
    .news-carousel-container {
        margin: 0 0.125rem;
        padding: 0.25rem 0;
    }
    
    #prevNews,
    #nextNews {
        padding: 0.375rem;
    }
    
    #prevNews {
        left: -0.125rem;
    }
    
    #nextNews {
        right: -0.125rem;
    }
    
    .news-slide {
        width: calc(100% / 1.1);
    }
    
    .news-card {
        min-height: 240px;
        margin: 0 0.0625rem;
    }
    
    .news-media {
        height: 100px;
    }
    
    .news-content {
        padding: 0.75rem;
    }
}

@media (max-width: 640px) {
    .news-slide {
        width: calc(100% / 1.2);
    }
}

@media (min-width: 1024px) {
    .news-slide {
        width: calc(100% / 3);
    }
}

@media (min-width: 768px) and (max-width: 1023px) {
    .news-slide {
        width: calc(100% / 2);
    }
}

/* Улучшенное масштабирование для мобильных устройств */
@media (max-width: 380px) {
    .news-card {
        min-height: 220px;
    }
    
    .news-media {
        height: 90px;
    }
    
    .news-content {
        padding: 0.5rem;
    }
}

/* Оптимизация для планшетов */
@media (min-width: 641px) and (max-width: 767px) {
    .news-slide {
        width: calc(100% / 1.5);
    }
}

/* Поддержка ориентации телефона */
@media (max-height: 600px) and (orientation: landscape) {
    .news-card {
        min-height: 200px;
    }
    
    .news-media {
        height: 80px;
    }
}

/* Фикс для модального окна на мобильных */
.modal-fixed {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.modal-content-fixed {
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

/* Улучшение кликабельности на мобильных */
@media (max-width: 768px) {
    .mobile-touch-fix {
        min-height: 44px;
        min-width: 44px;
    }
    
    .btn-mobile-fix {
        padding: 12px 16px;
        font-size: 16px; /* Предотвращает zoom в iOS */
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const newsCarousel = document.getElementById('newsCarousel');
    const prevButton = document.getElementById('prevNews');
    const nextButton = document.getElementById('nextNews');
    const indicators = document.querySelectorAll('.news-indicator');
    const newsSlides = document.querySelectorAll('.news-slide');
    const newsModal = document.getElementById('newsModal');
    const closeModal = document.getElementById('closeNewsModal');
    const modalContent = document.getElementById('newsModalContent');
    const newsCards = document.querySelectorAll('.news-card');
    
    let currentIndex = 0;
    let autoSlideInterval;
    let slidesPerView = calculateSlidesPerView();

    // Функция для применения стилей из data-атрибутов
    function applyDataStyles() {
        newsCards.forEach(card => {
            const bgColor = card.getAttribute('data-bg-color');
            const textColor = card.getAttribute('data-text-color');
            const buttonColor = card.getAttribute('data-button-color');
            
            if (bgColor) {
                card.style.backgroundColor = bgColor;
            }
            
            if (textColor) {
                const textElements = card.querySelectorAll('[data-text-color]');
                textElements.forEach(el => {
                    el.style.color = textColor;
                });
            }
            
            if (buttonColor) {
                const buttonElements = card.querySelectorAll('[data-button-color]');
                buttonElements.forEach(el => {
                    el.style.color = buttonColor;
                });
            }
            
            const borderElements = card.querySelectorAll('[data-border-color]');
            borderElements.forEach(el => {
                const borderColor = el.getAttribute('data-border-color');
                if (borderColor) {
                    el.style.borderColor = borderColor;
                }
            });
        });
    }

    function calculateSlidesPerView() {
        const width = window.innerWidth;
        if (width >= 1024) return 3;
        if (width >= 768) return 2;
        if (width >= 480) return 1.5;
        return 1.1;
    }

    function updateSlidesWidth() {
        slidesPerView = calculateSlidesPerView();
        if (newsCarousel) {
            newsCarousel.style.setProperty('--slides-per-view', slidesPerView);
            
            newsSlides.forEach(slide => {
                slide.style.width = `calc(100% / ${slidesPerView})`;
            });
        }
    }

    function updateCarousel() {
        if (!newsCarousel) return;
        
        const slideWidth = 100 / slidesPerView;
        const translateX = -currentIndex * slideWidth;
        newsCarousel.style.transform = `translateX(${translateX}%)`;
        
        indicators.forEach((indicator, index) => {
            const isActive = index === currentIndex;
            indicator.classList.toggle('active', isActive);
            indicator.classList.toggle('bg-dark-blue', isActive);
            indicator.classList.toggle('bg-gray-300', !isActive);
        });
    }
    
    function nextSlide() {
        if (!newsCarousel || newsSlides.length === 0) return;
        
        const maxIndex = Math.max(0, newsSlides.length - Math.floor(slidesPerView));
        currentIndex = currentIndex >= maxIndex ? 0 : currentIndex + 1;
        updateCarousel();
    }
    
    function prevSlide() {
        if (!newsCarousel || newsSlides.length === 0) return;
        
        const maxIndex = Math.max(0, newsSlides.length - Math.floor(slidesPerView));
        currentIndex = currentIndex <= 0 ? maxIndex : currentIndex - 1;
        updateCarousel();
    }
    
    if (indicators.length > 0) {
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                currentIndex = index;
                updateCarousel();
                resetAutoSlide();
            });
        });
    }
    
    function resetAutoSlide() {
        clearInterval(autoSlideInterval);
        if (newsSlides.length > 1) {
            autoSlideInterval = setInterval(nextSlide, 4000);
        }
    }
    
    if (prevButton) {
        prevButton.addEventListener('click', (e) => {
            e.stopPropagation();
            prevSlide();
            resetAutoSlide();
        });
    }
    
    if (nextButton) {
        nextButton.addEventListener('click', (e) => {
            e.stopPropagation();
            nextSlide();
            resetAutoSlide();
        });
    }
    
    function openNewsModal(newsIndex) {
        // Ищем карточку по data-news-index атрибуту
        let newsElement = document.querySelector(`.news-card[data-news-index="${newsIndex}"]`);
        
        // Если не нашли, ищем в слайдах карусели
        if (!newsElement) {
            const slide = document.querySelector(`.news-slide[data-news-index="${newsIndex}"]`);
            if (slide) {
                newsElement = slide.querySelector('.news-card');
            }
        }
        
        if (!newsElement) return;
        
        // Получаем данные из data-атрибутов
        const newsData = {
            title: newsElement.querySelector('h3')?.textContent || 'Новость',
            text: newsElement.getAttribute('data-promo-text') || '',
            image: newsElement.querySelector('img')?.src || '',
            date: newsElement.getAttribute('data-promo-date') || new Date().toLocaleDateString('ru-RU'),
            button_text: newsElement.getAttribute('data-button-text') || '',
            button_url: newsElement.getAttribute('data-button-url') || '',
            background_color: newsElement.getAttribute('data-bg-color') || '#1E3A8A',
            text_color: newsElement.getAttribute('data-text-color') || '#FFFFFF',
            button_color: newsElement.getAttribute('data-button-color') || '#C9A96A'
        };
        
        // Создаем контент модального окна
        modalContent.innerHTML = `
            <div class="space-y-4 sm:space-6">
                ${newsData.image ? `
                <div class="rounded-lg overflow-hidden">
                    <img src="${newsData.image}" alt="${newsData.title}" class="w-full h-32 sm:h-48 object-cover">
                </div>
                ` : `
                <div class="rounded-lg overflow-hidden h-32 sm:h-48 flex items-center justify-center" style="background-color: ${newsData.background_color}">
                    <!-- Без иконки и текста "Новость компании" -->
                </div>
                `}
                
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                    <h3 class="text-xl sm:text-2xl font-bold text-dark-blue">${newsData.title}</h3>
                    <span class="text-xs sm:text-sm px-2 sm:px-3 py-1 rounded-full bg-gray-100 text-dark-blue self-start sm:self-auto">${newsData.date}</span>
                </div>
                
                ${newsData.text ? `
                <div class="modal-text-content text-gray-700">
                    ${newsData.text}
                </div>
                ` : ''}
                
                ${newsData.button_text && newsData.button_url ? `
                <div class="pt-3 sm:pt-4">
                    <a href="${newsData.button_url}" target="_blank"
                       class="inline-block px-4 sm:px-6 py-3 sm:py-3 rounded-lg font-medium text-white transition-all duration-300 hover:scale-105 hover:shadow-lg text-center text-sm sm:text-base btn-mobile-fix"
                       style="background-color: ${newsData.button_color}; min-height: 44px; display: flex; align-items: center; justify-content: center;">
                        ${newsData.button_text}
                    </a>
                </div>
                ` : ''}
                
                <div class="pt-4 sm:pt-6 border-t border-gray-200 text-center">
                    <button class="bg-dark-blue hover:bg-blue-900 text-white px-6 sm:px-8 py-3 rounded-lg font-medium transition-colors duration-300 close-modal-btn text-sm sm:text-base btn-mobile-fix mobile-touch-fix"
                            style="min-height: 44px;">
                        Закрыть
                    </button>
                </div>
            </div>
        `;
        
        // Устанавливаем белый фон для модального окна
        const modalContainer = newsModal.querySelector('.rounded-xl');
        modalContainer.style.backgroundColor = '#ffffff';
        
        // Добавляем обработчик для кнопки закрытия в модальном окне
        setTimeout(() => {
            const closeBtn = modalContent.querySelector('.close-modal-btn');
            if (closeBtn) {
                closeBtn.addEventListener('click', closeNewsModal);
            }
            
            // Добавляем обработчик для внешней ссылки
            const externalLink = modalContent.querySelector('a[target="_blank"]');
            if (externalLink) {
                externalLink.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }
        }, 100);
        
        newsModal.classList.remove('hidden');
        newsModal.classList.add('show');
        setTimeout(() => {
            modalContainer.style.opacity = '1';
            modalContainer.style.transform = 'scale(1)';
        }, 10);
        
        // Предотвращаем скролл body при открытой модалке
        document.body.style.overflow = 'hidden';
        
        clearInterval(autoSlideInterval);
    }
    
    function closeNewsModal() {
        const modalContainer = newsModal.querySelector('.rounded-xl');
        modalContainer.style.opacity = '0';
        modalContainer.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
            newsModal.classList.add('hidden');
            newsModal.classList.remove('show');
            // Сбрасываем фон модального окна
            modalContainer.style.backgroundColor = '';
            // Восстанавливаем скролл body
            document.body.style.overflow = '';
            resetAutoSlide();
        }, 300);
    }
    
    // Обработчики для всех новостных карточек
    document.querySelectorAll('.news-card').forEach((card) => {
        card.addEventListener('click', (e) => {
            // Проверяем, что клик не по дочерним элементам с особым поведением
            if (!e.target.closest('a') && !e.target.closest('button')) {
                const newsIndex = card.getAttribute('data-news-index');
                if (newsIndex !== null) {
                    openNewsModal(newsIndex);
                }
            }
        });
    });
    
    // Обработчики для слайдов в карусели
    document.querySelectorAll('.news-slide').forEach((slide) => {
        slide.addEventListener('click', (e) => {
            // Проверяем, что клик не по навигационным кнопкам и не по ссылкам/кнопкам
            if (!e.target.closest('button') && !e.target.closest('a')) {
                const newsIndex = slide.getAttribute('data-news-index');
                if (newsIndex !== null) {
                    openNewsModal(newsIndex);
                }
            }
        });
    });
    
    // Улучшенные обработчики для модального окна
    if (closeModal) {
        closeModal.addEventListener('click', (e) => {
            e.stopPropagation();
            closeNewsModal();
        });
    }
    
    newsModal.addEventListener('click', (e) => {
        if (e.target === newsModal) {
            closeNewsModal();
        }
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !newsModal.classList.contains('hidden')) {
            closeNewsModal();
        }
    });
    
    // Автопрокрутка для карусели (2+ элементов)
    if (newsSlides.length > 1) {
        autoSlideInterval = setInterval(nextSlide, 4000);
        
        const carouselContainer = document.querySelector('.news-carousel-container');
        if (carouselContainer) {
            carouselContainer.addEventListener('mouseenter', () => {
                clearInterval(autoSlideInterval);
            });
            
            carouselContainer.addEventListener('mouseleave', () => {
                autoSlideInterval = setInterval(nextSlide, 4000);
            });
            
            // Останавливаем автопрокрутку при касании на мобильных
            carouselContainer.addEventListener('touchstart', () => {
                clearInterval(autoSlideInterval);
            });
        }
    }
    
    // Адаптация при изменении размера окна
    window.addEventListener('resize', function() {
        if (newsCarousel) {
            const oldSlidesPerView = slidesPerView;
            updateSlidesWidth();
            
            if (oldSlidesPerView !== slidesPerView) {
                currentIndex = 0;
                updateCarousel();
            }
        }
    });
    
    // Инициализация
    if (newsCarousel) {
        updateSlidesWidth();
        updateCarousel();
    }
    
    // Применяем стили из data-атрибутов после загрузки DOM
    applyDataStyles();
    
    // Обработка анимаций с задержкой
    const animatedElements = document.querySelectorAll('[data-animation-delay]');
    animatedElements.forEach(el => {
        const delay = el.getAttribute('data-animation-delay');
        el.style.animationDelay = delay;
    });
});
</script>
{% endif %}

<!-- Остальная часть кода без изменений -->
<!-- About Section -->
<section class="py-12 sm:py-16 bg-light-gray">
    <div class="container mx-auto px-4 sm:px-6">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-2xl sm:text-3xl md:text-4xl text-dark-blue mb-4 sm:mb-6 font-bold scroll-animate">О компании</h2>
            <p class="text-base sm:text-lg text-gray-700 mb-6 sm:mb-8 leading-relaxed scroll-animate" data-animation-delay="0.1s">
                Компания Аргус осуществляет деятельность в сфере строительства с 2004 года. 
                За это время мы собрали команду профессионалов, создали обширную материально-техническую 
                базу и накопили большой опыт работы с крупными девелоперами, 
                промышленными предприятиями и государственными учреждениями.
            </p>
            <a href="{% url 'about' %}" class="inline-block border-2 border-gold text-gold hover:bg-gold hover:text-white px-5 py-3 sm:px-6 sm:py-4 md:px-8 md:py-4 rounded-xl transition-all duration-400 font-medium text-sm sm:text-base md:text-lg whitespace-nowrap scroll-animate" data-animation-delay="0.2s">
                Подробнее о компании
            </a>
        </div>
    </div>
</section>

<!-- Services Section -->
<section class="py-12 sm:py-16 bg-white">
    <div class="container mx-auto px-4 sm:px-6">
        <h2 class="text-2xl sm:text-3xl md:text-4xl text-dark-blue text-center mb-8 sm:mb-12 font-bold scroll-animate">Ключевые услуги</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
            <!-- Service 1 -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-400 cursor-pointer p-4 sm:p-6 border border-gray-100 scroll-animate group">
                <div class="inline-flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-dark-blue text-gold mb-3 sm:mb-4 rounded-lg transition-all duration-400 group-hover:scale-110 group-hover:bg-gold group-hover:text-white">
                    <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                    </svg>
                </div>
                <h3 class="text-base sm:text-lg text-dark-blue mb-2 sm:mb-3 font-semibold group-hover:text-gold transition-colors duration-400">Системы пожаротушения</h3>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed group-hover:text-dark-blue transition-colors duration-400">Проектирование и монтаж автоматических систем</p>
            </div>
            
            <!-- Service 2 -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-400 cursor-pointer p-4 sm:p-6 border border-gray-100 scroll-animate group" data-animation-delay="0.05s">
                <div class="inline-flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-dark-blue text-gold mb-3 sm:mb-4 rounded-lg transition-all duration-400 group-hover:scale-110 group-hover:bg-gold group-hover:text-white">
                    <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                </div>
                <h3 class="text-base sm:text-lg text-dark-blue mb-2 sm:mb-3 font-semibold group-hover:text-gold transition-colors duration-400">Пожарная сигнализация</h3>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed group-hover:text-dark-blue transition-colors duration-400">Установка и обслуживание систем оповещения</p>
            </div>
            
            <!-- Service 3 -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-400 cursor-pointer p-4 sm:p-6 border border-gray-100 scroll-animate group" data-animation-delay="0.1s">
                <div class="inline-flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-dark-blue text-gold mb-3 sm:mb-4 rounded-lg transition-all duration-400 group-hover:scale-110 group-hover:bg-gold group-hover:text-white">
                    <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <h3 class="text-base sm:text-lg text-dark-blue mb-2 sm:mb-3 font-semibold group-hover:text-gold transition-colors duration-400">Электромонтажные работы</h3>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed group-hover:text-dark-blue transition-colors duration-400">Полный комплекс электромонтажных услуг</p>
            </div>
            
            <!-- Service 4 -->
            <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-400 cursor-pointer p-4 sm:p-6 border border-gray-100 scroll-animate group" data-animation-delay="0.15s">
                <div class="inline-flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14 bg-dark-blue text-gold mb-3 sm:mb-4 rounded-lg transition-all duration-400 group-hover:scale-110 group-hover:bg-gold group-hover:text-white">
                    <svg class="w-6 h-6 sm:w-7 sm:h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                    </svg>
                </div>
                <h3 class="text-base sm:text-lg text-dark-blue mb-2 sm:mb-3 font-semibold group-hover:text-gold transition-colors duration-400">Вентиляция</h3>
                <p class="text-xs sm:text-sm text-gray-600 leading-relaxed group-hover:text-dark-blue transition-colors duration-400">Системы вентиляции и кондиционирования</p>
            </div>
        </div>
        
        <!-- Divider -->
        <div class="w-full bg-gradient-to-r from-transparent via-gold/20 to-transparent h-px my-8 sm:my-12 transition-all duration-800"></div>
        
        <!-- All Services Button -->
        <div class="text-center scroll-animate" data-animation-delay="0.2s">
            <a href="{% url 'services' %}" class="inline-block bg-dark-blue hover:bg-blue-900 text-white px-6 py-3 sm:px-8 sm:py-4 rounded-xl font-medium shadow-lg transition-all duration-400 hover:scale-105 text-sm sm:text-base md:text-lg">
                Все услуги
            </a>
        </div>
    </div>
</section>

<!-- Projects Preview -->
<section class="py-12 sm:py-16 bg-light-gray">
    <div class="container mx-auto px-4 sm:px-6">
        <h2 class="text-2xl sm:text-3xl md:text-4xl text-dark-blue text-center mb-8 sm:mb-10 font-bold scroll-animate">Реализованные проекты</h2>
        
        <!-- Projects Carousel -->
        <div class="relative overflow-hidden">
            <div id="projectsCarousel" class="flex transition-transform duration-500 ease-in-out">
                {% for project in projects %}
                <div class="flex-shrink-0 w-full sm:w-1/2 lg:w-1/3 px-2 sm:px-3">
                    <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-400 overflow-hidden cursor-pointer project-card">
                        <div class="h-40 sm:h-56 overflow-hidden">
                            {% if project.image %}
                            <img src="{{ project.image.url }}" alt="{{ project.title }}" class="w-full h-full object-cover transition-transform duration-800 hover:scale-110">
                            {% else %}
                            <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                                <svg class="w-8 h-8 sm:w-12 sm:h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            {% endif %}
                        </div>
                        <div class="p-4 sm:p-6">
                            <h3 class="text-base sm:text-lg text-dark-blue mb-2 font-semibold">{{ project.title }}</h3>
                            {% if project.address %}
                            <p class="text-gray-600 mb-2 text-xs sm:text-sm">{{ project.address }}</p>
                            {% endif %}
                            <p class="text-gold font-medium text-xs sm:text-sm">{{ project.get_object_type_display }}</p>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="w-full text-center py-8 sm:py-12">
                    <div class="w-12 h-12 sm:w-16 sm:h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <h3 class="text-lg sm:text-xl font-bold text-dark-blue mb-2">Проекты не найдены</h3>
                    <p class="text-gray-600 text-sm sm:text-base">Пока нет добавленных проектов.</p>
                </div>
                {% endfor %}
            </div>
            
            <!-- Navigation Buttons -->
            {% if projects %}
            <button id="prevProject" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-white/90 hover:bg-white text-dark-blue p-2 sm:p-3 rounded-full shadow-lg transition-all duration-300 z-10 ml-2 sm:ml-4 hover:scale-110 border border-gray-200">
                <i data-lucide="chevron-left" class="w-4 h-4 sm:w-6 sm:h-6"></i>
            </button>
            <button id="nextProject" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-white/90 hover:bg-white text-dark-blue p-2 sm:p-3 rounded-full shadow-lg transition-all duration-300 z-10 mr-2 sm:mr-4 hover:scale-110 border border-gray-200">
                <i data-lucide="chevron-right" class="w-4 h-4 sm:w-6 sm:h-6"></i>
            </button>
            {% endif %}
        </div>
        
        <div class="text-center mt-8 sm:mt-10 scroll-animate" data-animation-delay="0.15s">
            <a href="{% url 'projects' %}" class="bg-dark-blue hover:bg-blue-900 text-white px-5 py-3 sm:px-6 sm:py-4 md:px-8 md:py-4 rounded-xl transition-all duration-400 font-medium shadow-lg text-sm sm:text-base md:text-lg whitespace-nowrap">
                Смотреть все проекты
            </a>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-12 sm:py-16 bg-dark-blue text-white">
    <div class="container mx-auto px-4 sm:px-6 text-center">
        <h2 class="text-2xl sm:text-3xl md:text-4xl mb-4 sm:mb-6 font-bold scroll-animate">Готовы начать сотрудничество?</h2>
        <p class="text-base sm:text-lg text-white/80 mb-6 sm:mb-8 max-w-2xl mx-auto leading-relaxed scroll-animate" data-animation-delay="0.1s">
            Оставьте заявку, и наш специалист свяжется с вами для обсуждения деталей проекта.
        </p>
        <a href="{% url 'order_kp' %}" class="btn-gold text-white px-5 py-3 sm:px-6 sm:py-4 md:px-8 md:py-4 rounded-xl font-medium shadow-lg transition-all duration-400 hover:bg-amber-700 text-sm sm:text-base md:text-lg whitespace-nowrap scroll-animate" data-animation-delay="0.2s">
            Получить КП
        </a>
    </div>
</section>

<style>
    .btn-gold {
        background: #C9A96A;
        transition: all 0.4s ease;
    }
    
    .btn-gold:hover {
        background: #B89960;
        transform: translateY(-1px);
    }
    
    .project-card {
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    .project-card:hover {
        transform: translateY(-3px);
    }

    /* Анимации для появления элементов при скролле */
    .scroll-animate {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.6s ease-out;
    }
    
    .scroll-animate.animated {
        opacity: 1;
        transform: translateY(0);
    }
    
    .animate-slide-up {
        opacity: 0;
        transform: translateY(30px);
        animation: slideUp 0.8s ease-out forwards;
    }
    
    @keyframes slideUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<script>
    // Инициализация иконок
    lucide.createIcons();
    
    // Карусель проектов
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('projectsCarousel');
        const prevButton = document.getElementById('prevProject');
        const nextButton = document.getElementById('nextProject');
        const projects = document.querySelectorAll('#projectsCarousel > div');
        
        if (projects.length > 0) {
            let currentIndex = 0;
            const projectsPerView = window.innerWidth >= 1024 ? 3 : window.innerWidth >= 768 ? 2 : 1;
            const totalSlides = projects.length;
            
            function updateCarousel() {
                const slideWidth = 100 / projectsPerView;
                const translateX = -currentIndex * slideWidth;
                carousel.style.transform = `translateX(${translateX}%)`;
            }
            
            function nextSlide() {
                currentIndex = (currentIndex + 1) % totalSlides;
                updateCarousel();
            }
            
            function prevSlide() {
                currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
                updateCarousel();
            }
            
            // Автопрокрутка каждые 5 секунд
            let autoSlide = setInterval(nextSlide, 5000);
            
            // Остановка автопрокрутки при наведении
            carousel.addEventListener('mouseenter', () => {
                clearInterval(autoSlide);
            });
            
            // Возобновление автопрокрутки при уходе курсора
            carousel.addEventListener('mouseleave', () => {
                autoSlide = setInterval(nextSlide, 5000);
            });
            
            // Навигация кнопками
            if (prevButton) prevButton.addEventListener('click', () => {
                clearInterval(autoSlide);
                prevSlide();
                autoSlide = setInterval(nextSlide, 5000);
            });
            
            if (nextButton) nextButton.addEventListener('click', () => {
                clearInterval(autoSlide);
                nextSlide();
                autoSlide = setInterval(nextSlide, 5000);
            });
            
            // Адаптация при изменении размера окна
            window.addEventListener('resize', function() {
                const newProjectsPerView = window.innerWidth >= 1024 ? 3 : window.innerWidth >= 768 ? 2 : 1;
                if (newProjectsPerView !== projectsPerView) {
                    updateCarousel();
                }
            });
            
            // Инициализация
            updateCarousel();
        }
        
        // Плавная прокрутка для якорей
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Анимация появления элементов при скролле
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animated');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.scroll-animate').forEach(el => {
            observer.observe(el);
        });
        
        // Обработка анимаций с задержкой
        const animatedElements = document.querySelectorAll('[data-animation-delay]');
        animatedElements.forEach(el => {
            const delay = el.getAttribute('data-animation-delay');
            el.style.animationDelay = delay;
        });
    });
</script>
{% endblock %}