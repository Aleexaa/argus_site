{% extends 'crm/base_crm.html' %}
{% load static %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞ - CRM –ê—Ä–≥—É—Å{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞</h1>
            <p class="text-gray-600">–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞ "{{ promo.title }}"</p>
        </div>
        <div>
            <a href="{% url 'crm_promo_blocks' %}" 
               class="border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium flex items-center gap-2 justify-center hover:bg-gray-50 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>
</div>

<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
        <form method="post" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}
            <input type="hidden" name="action" value="edit">
            <input type="hidden" name="promo_id" value="{{ promo.id }}">
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="space-y-6">
                <h2 class="text-xl font-bold text-gray-800 border-b border-gray-200 pb-3">üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–∞–Ω–Ω–µ—Ä–∞ *
                    </label>
                    <input type="text" name="title" value="{{ promo.title }}" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent transition-all"
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∫–∏–¥–∫–∞ 20% –Ω–∞ –≤—Å–µ —É—Å–ª—É–≥–∏">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –û–ø–∏—Å–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞
                    </label>
                    <textarea name="text" rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent transition-all resize-none"
                              placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è...">{{ promo.text }}</textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                        </label>
                        <input type="text" name="button_text" value="{{ promo.button_text }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent transition-all"
                               placeholder="–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            –°—Å—ã–ª–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏
                        </label>
                        <input type="url" name="button_url" value="{{ promo.button_url }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent transition-all"
                               placeholder="https://example.com">
                    </div>
                </div>
            </div>
            
            <!-- –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
            <div class="space-y-6">
                <h2 class="text-xl font-bold text-gray-800 border-b border-gray-200 pb-3">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h2>
                
                <!-- –§–æ–Ω -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        –§–æ–Ω –±–∞–Ω–Ω–µ—Ä–∞
                    </label>
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        <button type="button" onclick="setBackgroundColor('#1E3A8A')" class="h-10 bg-blue-900 rounded border-2 {% if promo.background_color == '#1E3A8A' %}border-blue-900{% else %}border-gray-300{% endif %}"></button>
                        <button type="button" onclick="setBackgroundColor('#059669')" class="h-10 bg-green-600 rounded border-2 {% if promo.background_color == '#059669' %}border-blue-900{% else %}border-gray-300{% endif %}"></button>
                        <button type="button" onclick="setBackgroundColor('#DC2626')" class="h-10 bg-red-600 rounded border-2 {% if promo.background_color == '#DC2626' %}border-blue-900{% else %}border-gray-300{% endif %}"></button>
                        <button type="button" onclick="setBackgroundColor('#7C3AED')" class="h-10 bg-purple-600 rounded border-2 {% if promo.background_color == '#7C3AED' %}border-blue-900{% else %}border-gray-300{% endif %}"></button>
                    </div>
                    <input type="color" name="background_color" id="backgroundColor" value="{{ promo.background_color }}" 
                           class="w-full h-12 rounded border border-gray-300 cursor-pointer">
                </div>
                
                <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è –±–∞–Ω–Ω–µ—Ä–∞
                    </label>
                    <input type="file" name="image" accept="image/*"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent transition-all file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-gold file:text-white hover:file:bg-dark-gold">
                    
                    {% if promo.image %}
                    <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600 mb-2">–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</p>
                        <img src="{{ promo.image.url }}" alt="Current banner image" class="h-20 w-auto rounded-lg">
                        <div class="mt-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" name="remove_image" value="true" class="w-4 h-4 text-gold border-gray-300 rounded focus:ring-gold">
                                <span class="text-sm text-gray-700">–£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>
                            </label>
                        </div>
                    </div>
                    {% endif %}
                    
        
                
                <!-- –¶–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                        </label>
                        <input type="color" name="text_color" value="{{ promo.text_color }}"
                               class="w-full h-10 rounded border border-gray-300 cursor-pointer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏
                        </label>
                        <input type="color" name="button_color" value="{{ promo.button_color }}"
                               class="w-full h-10 rounded border border-gray-300 cursor-pointer">
                    </div>
                </div>
            </div>
        
            
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                <button type="submit" 
                        class="flex-1 btn-gold px-6 py-4 rounded-lg font-medium text-lg hover:scale-105 transition-transform">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                <a href="{% url 'crm_promo_blocks' %}" 
                   class="flex-1 px-6 py-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium text-center">
                    –û—Ç–º–µ–Ω–∞
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// üé® –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–≤–µ—Ç–∞–º–∏
function setBackgroundColor(color) {
    document.getElementById('backgroundColor').value = color;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π –≤–∏–¥ –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('[onclick^="setBackgroundColor"]').forEach(btn => {
        btn.classList.remove('border-2', 'border-blue-900');
        btn.classList.add('border-2', 'border-gray-300');
    });
    
    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
    event.target.classList.remove('border-gray-300');
    event.target.classList.add('border-blue-900');
}
</script>
{% endblock %}

{% block styles %}
<style>
.btn-gold {
    background: linear-gradient(135deg, #C9A96A 0%, #B89960 100%);
    color: white;
    transition: all 0.3s ease;
}

.btn-gold:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(201, 169, 106, 0.3);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã */
input, textarea, select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
}

input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: #C9A96A;
    box-shadow: 0 0 0 3px rgba(201, 169, 106, 0.1);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ */
input[type="checkbox"] {
    width: 20px;
    height: 20px;
}

/* –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å */
.text-lg {
    font-size: 1.125rem;
    line-height: 1.6;
}
</style>
{% endblock %}