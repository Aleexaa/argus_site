{% for req in requests %}
<article class="request-card bg-white rounded-xl shadow-sm p-4 border-l-4 border-gold hover:shadow-md transition-all duration-300 mb-4 focus-within:ring-2 ring-gold"
          data-request-id="{{ req.id }}"
          aria-labelledby="request-title-{{ req.id }}"
          aria-describedby="request-desc-{{ req.id }}"
          tabindex="0">
    
    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start gap-4">
        <div class="flex-1 min-w-0">
            <header class="mb-3">
                <h3 id="request-title-{{ req.id }}" class="font-semibold text-base text-gray-800 truncate">
                    {{ req.client.company_name }}
                </h3>
                <p class="text-gray-600 text-sm mt-1">{{ req.object_type }}</p>
            </header>

            {% if req.description %}
            <p id="request-desc-{{ req.id }}" class="text-sm text-gray-600 line-clamp-2 mb-3">
                {{ req.description }}
            </p>
            {% endif %}

            <dl class="space-y-2 text-sm text-gray-500">
                {% if req.object_address %}
                <div class="flex items-center gap-2">
                    <dt class="flex items-center gap-1 min-w-0">
                        <span class="sr-only">–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</span>
                        <span aria-hidden="true">üìç</span>
                    </dt>
                    <dd class="min-w-0 truncate">{{ req.object_address }}</dd>
                </div>
                {% endif %}

                {% if req.attached_file %}
                <div class="flex items-center gap-2">
                    <dt class="flex items-center gap-1 min-w-0">
                        <span class="sr-only">–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª</span>
                        <span aria-hidden="true">üìé</span>
                    </dt>
                    <dd class="min-w-0">
                        <a href="{{ req.attached_file.url }}" 
                           download 
                           class="text-gold hover:text-gold-dark underline transition-colors"
                           aria-label="–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞—è–≤–∫–∏ {{ req.client.company_name }}">
                            –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
                        </a>
                    </dd>
                </div>
                {% endif %}
            </dl>
        </div>
        
        <div class="flex flex-col items-start lg:items-end gap-3 min-w-[180px]">
            <div class="flex flex-col items-start lg:items-end gap-2 w-full">
                <span class="status-badge {{ req.status }} text-xs px-3 py-1 rounded-full font-medium border"
                      role="status"
                      aria-label="–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏: {{ req.get_status_display }}">
                    {{ req.get_status_display }}
                </span>
                
                <div class="text-xs text-gray-500">
                    {% if req.responsible_manager %}
                    <span class="flex items-center gap-1" aria-label="–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä">
                        <span aria-hidden="true">üë§</span>
                        {{ req.responsible_manager.user.get_full_name|default:req.responsible_manager.user.username }}
                    </span>
                    {% else %}
                    <span class="text-gray-400 flex items-center gap-1">
                        <span aria-hidden="true">üë§</span>
                        –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <a href="{% url 'crm_request_detail' req.id %}" 
               class="text-gold hover:text-gold-dark text-sm font-medium transition-colors inline-flex items-center gap-1 group"
               aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞—è–≤–∫–µ {{ req.client.company_name }}">
                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                <span aria-hidden="true" class="group-hover:translate-x-0.5 transition-transform">‚Üí</span>
            </a>
        </div>
    </div>

    <footer class="mt-4 pt-3 border-t border-gray-100 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 text-xs text-gray-400">
        <time datetime="{{ req.created_at|date:'c' }}" class="flex items-center gap-1">
            <span aria-hidden="true">üïí</span>
            –°–æ–∑–¥–∞–Ω–æ: {{ req.created_at|date:"d.m.Y H:i" }}
        </time>
        {% if req.updated_at != req.created_at %}
        <time datetime="{{ req.updated_at|date:'c' }}" class="flex items-center gap-1">
            <span aria-hidden="true">‚úèÔ∏è</span>
            –û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ req.updated_at|date:"d.m.Y H:i" }}
        </time>
        {% endif %}
    </footer>
</article>
{% empty %}
<div class="bg-white rounded-xl shadow-sm p-8 text-center" role="status" aria-live="polite">
    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4" aria-hidden="true">
        <span class="text-2xl">üì≠</span>
    </div>
    <p class="text-gray-500 text-lg mb-2">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
    <p class="text-gray-400 text-sm">–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
</div>
{% endfor %}