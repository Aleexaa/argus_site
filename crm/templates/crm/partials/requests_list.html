{% for req in requests %}
<div class="bg-white rounded-xl shadow-sm p-4 border-l-4 border-gold hover:shadow-md transition-all duration-300 mb-4"
     data-request-id="{{ req.id }}">
    <div class="flex justify-between items-start">
        <div class="flex-1">
            <h3 class="font-semibold text-base text-gray-800">{{ req.client.company_name }}</h3>
            <p class="text-gray-600 text-sm mt-1">{{ req.object_type }}</p>
            
            {% if req.description %}
                <p class="mt-2 text-sm text-gray-600 italic">üìù {{ req.description|truncatechars:100 }}</p>
            {% endif %}

            {% if req.area %}
                <p class="text-sm text-gray-500 mt-1">üìè –ü–ª–æ—â–∞–¥—å: {{ req.area }} –º¬≤</p>
            {% endif %}

            {% if req.attached_file %}
                <a href="{{ req.attached_file.url }}" download class="text-sm text-gold hover:underline inline-flex items-center mt-2">
                    üìé –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
                </a>
            {% endif %}

            {% if req.object_address %}
                <p class="mt-2 text-sm text-gray-500">üìç {{ req.object_address }}</p>
            {% endif %}
        </div>
        
        <div class="flex flex-col items-end gap-2">
            <span class="text-xs px-3 py-1 rounded-full font-medium 
                {% if req.status == 'new' %}bg-blue-100 text-blue-800 border border-blue-200
                {% elif req.status == 'in_progress' %}bg-yellow-100 text-yellow-800 border border-yellow-200
                {% elif req.status == 'kp_ready' %}bg-purple-100 text-purple-800 border border-purple-200
                {% elif req.status == 'closed' %}bg-green-100 text-green-800 border border-green-200
                {% else %}bg-gray-100 text-gray-800 border border-gray-200{% endif %}">
                {{ req.get_status_display }}
            </span>
            
            {% if req.responsible_manager %}
                <span class="text-xs text-gray-500">
                    üë§ {{ req.responsible_manager.user.get_full_name|default:req.responsible_manager.user.username }}
                </span>
            {% else %}
                <span class="text-xs text-gray-400">üë§ –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</span>
            {% endif %}
            
            <a href="{% url 'crm_request_detail' req.id %}" class="text-gold hover:text-gold-dark text-sm font-medium">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
        </div>
    </div>

    <div class="mt-3 pt-3 border-t border-gray-100 flex justify-between items-center">
        <span class="text-xs text-gray-400">–°–æ–∑–¥–∞–Ω–æ: {{ req.created_at|date:"d.m.Y H:i" }}</span>
        {% if req.updated_at != req.created_at %}
            <span class="text-xs text-gray-400">–û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ req.updated_at|date:"d.m.Y H:i" }}</span>
        {% endif %}
    </div>
</div>
{% empty %}
<div class="bg-white rounded-xl shadow-sm p-8 text-center">
    <p class="text-gray-500 italic text-lg">üì≠ –ù–µ—Ç –∑–∞—è–≤–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
    <p class="text-gray-400 text-sm mt-2">–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
</div>
{% endfor %}